<!DOCTYPE html>
<html>
    <head>
        <script>
        
            safari.application.addEventListener('command', performCommand, false);
            safari.application.addEventListener('message', handleMessage, false);

            function performCommand(event) {
                var message = '';
                
                switch(event.command){
                    case 'gotoP4TTicket': {
                        message = 'getSelectedTextForP4TTicket';
                        break;
                    }
                    
                    case 'gotoAgileZENCard': {
                        message = 'getSelectedTextForAgileZENCard';
                        break;
                    }
                }
                
                safari.application.activeBrowserWindow.activeTab.page.dispatchMessage(message, '');
            }


            function handleMessage(msg) {
                var url = '';
                
                switch(msg.name){
                    case 'theSelectionForP4TTicket': {
                        url = 'https://www.pool4tool.com/tickets/index.php?controller=ticketByID&doNotRedirectToP4T=true&id='+msg.message;
                        break;
                    }
                    
                    case 'theSelectionForAgileZenCard': {
                        url = 'https://agilezen.com/project/26520/story/'+msg.message+'/';
                        break;
                    }
                }        
                
                safari.application.activeBrowserWindow.openTab().url = url;      
            }            
        </script>
    </head>
    <body></body>
</html>